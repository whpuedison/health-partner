<!--pages/index/index.wxml-->
<view class="index-page">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view class="user-info">
      <block wx:if="{{hasUserInfo}}">
        <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        <view class="user-text">
          <text class="greeting">{{userInfo.nickName}}</text>
          <text class="status-text">æ¬¢è¿ä½¿ç”¨</text>
        </view>
      </block>
      <block wx:else>
        <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
          <image wx:if="{{userInfo && userInfo.avatarUrl}}" class="avatar-placeholder" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
          <view wx:else class="avatar-placeholder">ğŸ‘¤</view>
        </button>
        <input 
          class="nickname-input" 
          type="nickname" 
          placeholder="ç‚¹å‡»è®¾ç½®æ˜µç§°"
          bindinput="onNicknameInput"
          bindblur="onNicknameInput"
          value="{{nickname || (userInfo && userInfo.nickName) || ''}}"
        />
      </block>
    </view>
    
    <!-- å¥åº·æ•°æ®æ¦‚è§ˆ -->
    <view class="health-overview" wx:if="{{healthData.weight > 0}}">
      <view class="health-item">
        <text class="health-value">{{healthData.bmi}}</text>
        <text class="health-label">BMI</text>
      </view>
      <view class="health-divider"></view>
      <view class="health-item">
        <text class="health-value">{{healthData.weight}}</text>
        <text class="health-label">ä½“é‡(kg)</text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥æ•°æ® -->
  <view class="today-section">
    <view class="section-header">
      <text class="section-title">ä»Šæ—¥ç›®æ ‡</text>
    </view>
    
    <view class="stats-grid">
      <!-- è¿åŠ¨ -->
      <view 
        class="stat-card checkin-card" 
        data-type="exercise"
        bindtap="onCheckIn"
      >
        <text class="stat-icon">ğŸ’ª</text>
        <text class="stat-value">{{todayStats.exercise}}</text>
        <text class="stat-label">/ {{todayStats.targetExercise}} åˆ†é’Ÿ</text>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{todayStats.targetExercise > 0 ? (todayStats.exercise / todayStats.targetExercise * 100 > 100 ? 100 : todayStats.exercise / todayStats.targetExercise * 100) : 0}}%"></view>
        </view>
        <text class="checkin-hint">è¿åŠ¨æ—¶é—´</text>
      </view>
      
      <!-- ä»Šæ—¥å·²æ‘„å…¥çƒ­é‡ -->
      <view 
        class="stat-card checkin-card" 
        data-type="intake"
        bindtap="onCheckIn"
      >
        <text class="stat-icon">ğŸ½ï¸</text>
        <text class="stat-value">{{todayStats.intakeCalories}}</text>
        <text class="stat-label">/ {{todayStats.targetIntakeCalories}} å¡</text>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{todayStats.targetIntakeCalories > 0 ? (todayStats.intakeCalories / todayStats.targetIntakeCalories * 100 > 100 ? 100 : todayStats.intakeCalories / todayStats.targetIntakeCalories * 100) : 0}}%"></view>
        </view>
        <text class="checkin-hint">æ‘„å…¥çƒ­é‡</text>
      </view>
      
      <!-- ä»Šæ—¥è¿åŠ¨æ¶ˆè€—çƒ­é‡ -->
      <view 
        class="stat-card checkin-card" 
        data-type="burned"
        bindtap="onCheckIn"
      >
        <text class="stat-icon">ğŸ”¥</text>
        <text class="stat-value">{{todayStats.exerciseCalories}}</text>
        <text class="stat-label">/ {{todayStats.targetExerciseCalories}} å¡</text>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{todayStats.targetExerciseCalories > 0 ? (todayStats.exerciseCalories / todayStats.targetExerciseCalories * 100 > 100 ? 100 : todayStats.exerciseCalories / todayStats.targetExerciseCalories * 100) : 0}}%"></view>
        </view>
        <text class="checkin-hint">æ¶ˆè€—çƒ­é‡</text>
      </view>
    </view>
  </view>

  <!-- å¿«æ·åŠŸèƒ½ -->
  <view class="quick-actions">
    <view class="section-header">
      <text class="section-title">å¿«æ·åŠŸèƒ½</text>
    </view>
    
    <view class="actions-grid">
      <view 
        class="action-item" 
        wx:for="{{quickActions}}" 
        wx:key="id"
        style="background: linear-gradient(135deg, {{item.color}}25, {{item.color}}45); box-shadow: 0 8rpx 20rpx {{item.color}}40; border-color: {{item.color}}60;"
        data-url="{{item.url}}"
        data-tab="{{item.tab}}"
        bindtap="onActionTap"
      >
        <text class="action-icon">{{item.icon}}</text>
        <text class="action-title">{{item.title}}</text>
      </view>
    </view>
  </view>

  <!-- å¥åº·å°è´´å£« -->
  <view class="tips-section">
    <view class="section-header">
      <text class="section-title">å¥åº·å°è´´å£«</text>
    </view>
    
    <view class="tip-card">
      <text class="tip-text">{{healthTips[currentTip]}}</text>
      <view class="tip-dots">
        <view 
          class="dot {{index === currentTip ? 'active' : ''}}" 
          wx:for="{{healthTips}}" 
          wx:key="index"
        ></view>
      </view>
    </view>
  </view>
</view>

