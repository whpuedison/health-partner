<!--pages/index/index.wxml-->
<view class="index-page">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view class="user-info">
      <block wx:if="{{hasUserInfo}}">
        <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        <view class="user-text">
          <text class="greeting">{{userInfo.nickName}}</text>
          <text class="status-text">{{healthData.status}}</text>
        </view>
      </block>
      <block wx:else>
        <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
          <image wx:if="{{userInfo && userInfo.avatarUrl}}" class="avatar-placeholder" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
          <view wx:else class="avatar-placeholder">ğŸ‘¤</view>
        </button>
        <input 
          class="nickname-input" 
          type="nickname" 
          placeholder="ç‚¹å‡»è®¾ç½®æ˜µç§°"
          bindinput="onNicknameInput"
          bindblur="onNicknameInput"
          value="{{nickname || (userInfo && userInfo.nickName) || ''}}"
        />
      </block>
    </view>
    
    <!-- å¥åº·æ•°æ®æ¦‚è§ˆ -->
    <view class="health-overview" wx:if="{{healthData.weight > 0}}">
      <view class="health-item">
        <text class="health-value">{{healthData.bmi}}</text>
        <text class="health-label">BMI</text>
      </view>
      <view class="health-divider"></view>
      <view class="health-item">
        <text class="health-value">{{healthData.weight}}</text>
        <text class="health-label">ä½“é‡(kg)</text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥æ•°æ® -->
  <view class="today-section">
    <view class="section-header">
      <text class="section-title">ä»Šæ—¥ç›®æ ‡</text>
    </view>
    
    <view class="stats-grid">
      <view 
        class="stat-card checkin-card" 
        data-type="exercise"
        data-value="{{todayStats.exercise}}"
        bindtap="onCheckIn"
      >
        <text class="stat-icon">ğŸƒ</text>
        <text class="stat-value">{{todayStats.exercise}}</text>
        <text class="stat-label">/ {{todayStats.targetExercise}} åˆ†é’Ÿ</text>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{todayStats.targetExercise > 0 ? (todayStats.exercise / todayStats.targetExercise * 100 > 100 ? 100 : todayStats.exercise / todayStats.targetExercise * 100) : 0}}%"></view>
        </view>
        <text class="checkin-hint">ç‚¹å‡»æ‰“å¡</text>
      </view>
      
      <view 
        class="stat-card checkin-card" 
        data-type="water"
        data-value="{{todayStats.water}}"
        bindtap="onCheckIn"
      >
        <text class="stat-icon">ğŸ’§</text>
        <text class="stat-value">{{todayStats.water}}</text>
        <text class="stat-label">/ {{todayStats.targetWater}} æ¯æ°´</text>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{todayStats.targetWater > 0 ? (todayStats.water / todayStats.targetWater * 100 > 100 ? 100 : todayStats.water / todayStats.targetWater * 100) : 0}}%"></view>
        </view>
        <text class="checkin-hint">ç‚¹å‡»æ‰“å¡</text>
      </view>
      
      <view 
        class="stat-card checkin-card" 
        data-type="steps"
        data-value="{{todayStats.steps}}"
        bindtap="onCheckIn"
      >
        <text class="stat-icon">ğŸ‘£</text>
        <text class="stat-value">{{todayStats.steps}}</text>
        <text class="stat-label">/ {{todayStats.targetSteps}} æ­¥</text>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{todayStats.targetSteps > 0 ? (todayStats.steps / todayStats.targetSteps * 100 > 100 ? 100 : todayStats.steps / todayStats.targetSteps * 100) : 0}}%"></view>
        </view>
        <text class="checkin-hint">ç‚¹å‡»æ‰“å¡</text>
      </view>
    </view>
  </view>

  <!-- å¿«æ·åŠŸèƒ½ -->
  <view class="quick-actions">
    <view class="section-header">
      <text class="section-title">å¿«æ·åŠŸèƒ½</text>
    </view>
    
    <view class="actions-grid">
      <view 
        class="action-item" 
        wx:for="{{quickActions}}" 
        wx:key="id"
        style="background: linear-gradient(135deg, {{item.color}}15, {{item.color}}30);"
        data-url="{{item.url}}"
        data-tab="{{item.tab}}"
        bindtap="onActionTap"
      >
        <text class="action-icon">{{item.icon}}</text>
        <text class="action-title">{{item.title}}</text>
      </view>
    </view>
  </view>

  <!-- å¥åº·å°è´´å£« -->
  <view class="tips-section">
    <view class="section-header">
      <text class="section-title">å¥åº·å°è´´å£«</text>
    </view>
    
    <view class="tip-card">
      <text class="tip-text">{{healthTips[currentTip]}}</text>
      <view class="tip-dots">
        <view 
          class="dot {{index === currentTip ? 'active' : ''}}" 
          wx:for="{{healthTips}}" 
          wx:key="index"
        ></view>
      </view>
    </view>
  </view>
</view>

