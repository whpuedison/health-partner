<!--pages/timeline/timeline.wxml-->
<view class="timeline-page">
  <!-- å‘å¸ƒæŒ‰é’® -->
  <view class="create-btn" bindtap="goToCreate">
    <text class="create-icon">âœï¸</text>
    <text class="create-text">å‘å¸ƒ</text>
  </view>

  <!-- å¸–å­åˆ—è¡¨ -->
  <view class="posts-list">
    <view class="post-item" wx:for="{{posts}}" wx:key="id">
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="post-header">
        <image class="user-avatar" src="{{item.avatar_url || '/static/default-avatar.png'}}" mode="aspectFill"></image>
        <view class="user-info">
          <text class="user-name">{{item.nickname || 'åŒ¿åç”¨æˆ·'}}</text>
          <text class="post-time">{{item.created_at}}</text>
        </view>
        <!-- æ—¶å…‰è½´ä¸­æ‰€æœ‰å¸–å­éƒ½æ˜¾ç¤ºåˆ é™¤æŒ‰é’® -->
        <view class="post-actions">
          <text class="delete-btn" data-id="{{item.id}}" bindtap="deletePost">åˆ é™¤</text>
        </view>
      </view>

      <!-- å¸–å­å†…å®¹ -->
      <view class="post-content">
        <text class="content-text">{{item.content}}</text>
      </view>

      <!-- å¸–å­å›¾ç‰‡ -->
      <view class="post-images" wx:if="{{item.images && item.images.length > 0}}">
        <!-- å•å¼ å›¾ç‰‡ -->
        <view class="images-grid images-single" wx:if="{{item.images.length === 1}}">
          <image 
            class="image-single" 
            src="{{item.images[0]}}" 
            mode="widthFix"
            data-url="{{item.images[0]}}"
            data-urls="{{item.images}}"
            bindtap="previewImage"
          ></image>
        </view>
        <!-- 2å¼ å›¾ç‰‡ -->
        <view class="images-grid images-2" wx:elif="{{item.images.length === 2}}">
          <view 
            class="image-item" 
            wx:for="{{item.images}}" 
            wx:key="*this"
            wx:for-item="img"
            data-url="{{img}}"
            data-urls="{{item.images}}"
            bindtap="previewImage"
          >
            <image 
              src="{{img}}" 
              mode="aspectFill"
            ></image>
          </view>
        </view>
        <!-- 3-4å¼ å›¾ç‰‡ï¼š2x2ç½‘æ ¼ -->
        <view class="images-grid images-4" wx:elif="{{item.images.length <= 4}}">
          <view 
            class="image-item" 
            wx:for="{{item.images}}" 
            wx:key="*this"
            wx:for-item="img"
            data-url="{{img}}"
            data-urls="{{item.images}}"
            bindtap="previewImage"
          >
            <image 
              src="{{img}}" 
              mode="aspectFill"
            ></image>
          </view>
        </view>
        <!-- 5-6å¼ å›¾ç‰‡ï¼š3åˆ— -->
        <view class="images-grid images-6" wx:elif="{{item.images.length <= 6}}">
          <view 
            class="image-item" 
            wx:for="{{item.images}}" 
            wx:key="*this"
            wx:for-item="img"
            data-url="{{img}}"
            data-urls="{{item.images}}"
            bindtap="previewImage"
          >
            <image 
              src="{{img}}" 
              mode="aspectFill"
            ></image>
          </view>
        </view>
        <!-- 7-9å¼ å›¾ç‰‡ï¼š3x3ç½‘æ ¼ -->
        <view class="images-grid images-9" wx:else>
          <view 
            class="image-item" 
            wx:for="{{item.images}}" 
            wx:key="*this"
            wx:for-item="img"
            data-url="{{img}}"
            data-urls="{{item.images}}"
            bindtap="previewImage"
          >
            <image 
              src="{{img}}" 
              mode="aspectFill"
            ></image>
          </view>
        </view>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-more" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>
    <view class="no-more" wx:if="{{!hasMore && posts.length > 0}}">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
    <view class="empty-state" wx:if="{{!loading && posts.length === 0}}">
      <text class="empty-icon">ğŸ“­</text>
      <text class="empty-text">è¿˜æ²¡æœ‰å‘å¸ƒè¿‡å¸–å­ï¼Œå¿«æ¥å‘å¸ƒç¬¬ä¸€æ¡å§~</text>
    </view>
  </view>
</view>

