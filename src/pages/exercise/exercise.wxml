<!--pages/exercise/exercise.wxml-->
<view class="exercise-page">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">è¿åŠ¨è®¡åˆ’</text>
    <text class="page-subtitle">åšæŒè¿åŠ¨ï¼Œä¿æŒæ´»åŠ›</text>
  </view>

  <!-- ä»Šæ—¥è¿åŠ¨æ¦‚è§ˆ -->
  <view class="stats-card">
    <view class="stat-item">
      <text class="stat-icon">â±ï¸</text>
      <view class="stat-info">
        <text class="stat-value">{{todayStats.duration}}</text>
        <text class="stat-label">åˆ†é’Ÿ</text>
      </view>
    </view>
    
    <view class="stat-divider"></view>
    
    <view class="stat-item">
      <text class="stat-icon">ğŸ”¥</text>
      <view class="stat-info">
        <text class="stat-value">{{todayStats.calories}}</text>
        <text class="stat-label">å¡è·¯é‡Œ</text>
      </view>
    </view>
    
    <view class="stat-divider"></view>
    
    <view class="stat-item">
      <text class="stat-icon">ğŸ“</text>
      <view class="stat-info">
        <text class="stat-value">{{todayStats.distance}}</text>
        <text class="stat-label">å…¬é‡Œ</text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥ç›®æ ‡è¿›åº¦ -->
  <view class="goal-card">
    <view class="goal-header">
      <text class="goal-title">ä»Šæ—¥ç›®æ ‡</text>
      <text class="goal-status">{{todayStats.duration >= todayStats.target ? 'å·²å®Œæˆ âœ“' : todayStats.target - todayStats.duration + 'åˆ†é’Ÿ'}}</text>
    </view>
    <view class="goal-progress">
      <view class="goal-fill" style="width: {{todayStats.duration / todayStats.target * 100}}%"></view>
    </view>
  </view>

  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs">
    <view 
      class="tab-item {{activeTab === index ? 'active' : ''}}" 
      wx:for="{{tabs}}" 
      wx:key="index"
      data-index="{{index}}"
      bindtap="onTabChange"
    >
      {{item}}
    </view>
  </view>

  <!-- ä»Šæ—¥è¿åŠ¨ -->
  <view class="tab-content" wx:if="{{activeTab === 0}}">
    <!-- å¿«æ·è¿åŠ¨é€‰æ‹© -->
    <view class="quick-exercises">
      <view 
        class="exercise-btn" 
        wx:for="{{quickExercises}}" 
        wx:key="id"
        style="background: {{item.color}}20; border-color: {{item.color}};"
        data-exercise="{{item}}"
        bindtap="openAddDialog"
      >
        <text class="exercise-icon">{{item.icon}}</text>
        <text class="exercise-name">{{item.name}}</text>
      </view>
    </view>

    <!-- ä»Šæ—¥è®°å½• -->
    <view class="section-title" wx:if="{{todayRecords.length > 0}}">ä»Šæ—¥å·²å®Œæˆ</view>
    <view class="records-list" wx:if="{{todayRecords.length > 0}}">
      <view class="record-item" wx:for="{{todayRecords}}" wx:key="id">
        <text class="record-icon">{{item.icon}}</text>
        <view class="record-info">
          <view class="record-name-row">
            <text class="record-name">{{item.name}}</text>
            <text class="record-duration">{{item.duration}}åˆ†é’Ÿ</text>
            <text class="record-distance" wx:if="{{item.distance}}">{{item.distance}}km</text>
          </view>
          <text class="record-time">{{item.time}}</text>
        </view>
        <view class="record-stats">
          <text class="record-stat">{{item.calories}}å¡</text>
        </view>
        <text class="delete-btn" data-id="{{item.id}}" bindtap="deleteRecord">âœ•</text>
      </view>
    </view>

    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ’ª</text>
      <text class="empty-text">è¿˜æ²¡æœ‰è¿åŠ¨è®°å½•ï¼Œé€‰æ‹©ä¸€é¡¹è¿åŠ¨å¼€å§‹å§ï¼</text>
    </view>
  </view>

  <!-- è¿åŠ¨è®°å½• -->
  <view class="tab-content" wx:if="{{activeTab === 1}}">
    <view class="week-summary">
      <text class="summary-title">æœ¬å‘¨è¿åŠ¨ç»Ÿè®¡</text>
      <view class="summary-grid">
        <view class="summary-item">
          <text class="summary-value">{{weekRecords.length}}</text>
          <text class="summary-label">æ¬¡æ•°</text>
        </view>
        <view class="summary-item">
          <text class="summary-value">{{weekTotalDuration}}</text>
          <text class="summary-label">æ€»æ—¶é•¿(åˆ†é’Ÿ)</text>
        </view>
        <view class="summary-item">
          <text class="summary-value">{{weekTotalCalories}}</text>
          <text class="summary-label">æ€»æ¶ˆè€—(å¡)</text>
        </view>
      </view>
    </view>

    <view class="history-list" wx:if="{{weekRecords.length > 0}}">
      <view class="history-item" wx:for="{{weekRecords}}" wx:key="id">
        <view class="history-date">
          <text class="date-day">{{item.date}}</text>
          <text class="date-time">{{item.time}}</text>
        </view>
        <view class="history-content">
          <text class="history-icon">{{item.icon}}</text>
          <view class="history-info">
            <text class="history-name">{{item.name}}</text>
            <text class="history-detail">{{item.duration}}åˆ†é’Ÿ Â· {{item.calories}}å¡<text wx:if="{{item.distance}}"> Â· {{item.distance}}km</text></text>
          </view>
        </view>
      </view>
    </view>

    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ“Š</text>
      <text class="empty-text">æš‚æ— å†å²è®°å½•</text>
    </view>
  </view>

  <!-- æ·»åŠ å¯¹è¯æ¡† -->
  <view class="dialog-mask" wx:if="{{showAddDialog}}" bindtap="closeAddDialog">
    <view class="dialog-content" catchtap="stopPropagation">
      <view class="dialog-header">
        <text class="dialog-title">{{currentExercise.icon}} {{currentExercise.name}}</text>
        <text class="dialog-close" bindtap="closeAddDialog">âœ•</text>
      </view>
      
      <view class="dialog-body">
        <view class="form-item">
          <text class="form-label">è¿åŠ¨æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</text>
          <input 
            class="form-input" 
            type="number"
            placeholder="ä¾‹å¦‚ï¼š30"
            value="{{durationInput}}"
            bindinput="onDurationInput"
          />
        </view>
        
        <view class="form-item" wx:if="{{currentExercise && currentExercise.needsDistance}}">
          <text class="form-label">è¿åŠ¨è·ç¦»ï¼ˆå…¬é‡Œï¼‰</text>
          <input 
            class="form-input" 
            type="digit"
            placeholder="ä¾‹å¦‚ï¼š5.0"
            value="{{distanceInput}}"
            bindinput="onDistanceInput"
          />
        </view>
        
        <view class="form-hint">
          <text>ğŸ’¡ å¡è·¯é‡Œå°†æ ¹æ®è¿åŠ¨ç±»å‹å’Œæ—¶é•¿è‡ªåŠ¨è®¡ç®—</text>
        </view>
      </view>
      
      <view class="dialog-footer">
        <button class="dialog-btn cancel" bindtap="closeAddDialog">å–æ¶ˆ</button>
        <button class="dialog-btn confirm" bindtap="addRecord">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view>

