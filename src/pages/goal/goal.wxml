<!--pages/goal/goal.wxml-->
<view class="goal-page">
  <view class="page-header">
    <text class="page-title">ğŸ¯ ç›®æ ‡è®¾ç½®</text>
    <text class="page-subtitle">è®¾å®šæ˜ç¡®ç›®æ ‡ï¼ŒåšæŒå°±æ˜¯èƒœåˆ©</text>
  </view>

  <!-- å½“å‰çŠ¶æ€ -->
  <view class="current-status">
    <text class="section-title">å½“å‰çŠ¶æ€</text>
    <view class="status-grid">
      <view class="status-item">
        <text class="status-label">ä½“é‡</text>
        <text class="status-value">{{profile.weight}} kg</text>
      </view>
      <view class="status-item">
        <text class="status-label">BMI</text>
        <text class="status-value">{{profile.bmi}}</text>
      </view>
    </view>
  </view>

  <!-- ç†æƒ³ä½“é‡èŒƒå›´ -->
  <view class="info-card">
    <text class="info-title">ğŸ’¡ å‚è€ƒæ•°æ®</text>
    <view class="info-item">
      <text class="info-label">ç†æƒ³ä½“é‡èŒƒå›´</text>
      <text class="info-value">{{idealWeightRange.min}} - {{idealWeightRange.max}} kg</text>
    </view>
    <view class="info-item">
      <text class="info-label">åŸºç¡€ä»£è°¢ç‡ (BMR)</text>
      <text class="info-value">{{bmr}} å¡/å¤©</text>
    </view>
  </view>

  <!-- çƒ­é‡æ¨è -->
  <view class="info-card" wx:if="{{calorieRecommendation}}">
    <text class="info-title">ğŸ”¥ çƒ­é‡æ¨è</text>
    <view class="info-item">
      <text class="info-label">éè¿åŠ¨æ—¥æ¨èæ‘„å…¥</text>
      <text class="info-value highlight">{{calorieRecommendation.restDayIntake}} å¡</text>
    </view>
    <view class="info-item" wx:if="{{goals.dailyExercise > 0}}">
      <text class="info-label">è¿åŠ¨æ¶ˆè€—ï¼ˆ{{goals.dailyExercise}}åˆ†é’Ÿï¼‰</text>
      <text class="info-value">{{calorieRecommendation.exerciseCalories}} å¡</text>
    </view>
    <view class="info-item" wx:if="{{goals.dailyExercise > 0}}">
      <text class="info-label">è¿åŠ¨æ—¥æ¨èæ‘„å…¥</text>
      <text class="info-value highlight">{{calorieRecommendation.exerciseDayIntake}} å¡</text>
    </view>
    <view class="info-hint" wx:if="{{calorieRecommendation.goalType === 'lose'}}">
      <text>ğŸ’¡ å‡è‚¥å»ºè®®ï¼šæ¯æ—¥çƒ­é‡ç¼ºå£ {{calorieRecommendation.calorieDeficit}} å¡ï¼Œå¥åº·å‡é‡é€Ÿåº¦çº¦æ¯å‘¨0.75kg</text>
    </view>
    <view class="info-hint" wx:if="{{calorieRecommendation.goalType === 'gain'}}">
      <text>ğŸ’¡ å¢é‡å»ºè®®ï¼šæ¯æ—¥çƒ­é‡ç›ˆä½™ {{calorieRecommendation.calorieSurplus}} å¡</text>
    </view>
  </view>

  <!-- ç›®æ ‡è®¾ç½®è¡¨å• -->
  <view class="goal-form">
    <text class="section-title">è®¾å®šç›®æ ‡</text>
    
    <view class="form-section">
      <text class="form-section-title">ä½“é‡ç›®æ ‡</text>
      
      <view class="form-item">
        <text class="form-label">ç›®æ ‡ä½“é‡ (kg)</text>
        <input 
          class="form-input" 
          type="digit"
          placeholder="ä¾‹å¦‚ï¼š60"
          value="{{goals.targetWeight}}"
          data-field="targetWeight"
          bindinput="onInputChange"
        />
      </view>
      
      <view class="form-item">
        <text class="form-label">ç›®æ ‡æ—¥æœŸ</text>
        <picker 
          mode="date" 
          value="{{goals.targetDate}}" 
          bindchange="onDateChange"
          start="{{today}}"
        >
          <view class="picker-view">
            {{goals.targetDate || 'é€‰æ‹©æ—¥æœŸ'}}
          </view>
        </picker>
      </view>
    </view>

    <view class="form-section">
      <text class="form-section-title">æ¯æ—¥ç›®æ ‡</text>
      
      <view class="form-item">
        <view class="calorie-difference" wx:if="{{calorieRecommendation && goals.restDayCalories && parseInt(goals.restDayCalories) > 0}}">
          <text class="difference-label" wx:if="{{calorieRecommendation.goalType === 'lose'}}">
            çƒ­é‡ç¼ºå£: 
          </text>
          <text class="difference-label" wx:if="{{calorieRecommendation.goalType === 'gain'}}">
            çƒ­é‡ç›ˆä½™: 
          </text>
          <text class="difference-value" wx:if="{{calorieRecommendation.goalType === 'lose'}}">
            {{calorieRecommendation.restDayIntake - parseInt(goals.restDayCalories)}} å¡
          </text>
          <text class="difference-value" wx:if="{{calorieRecommendation.goalType === 'gain'}}">
            {{parseInt(goals.restDayCalories) - calorieRecommendation.restDayIntake}} å¡
          </text>
        </view>
        <text class="form-label">éè¿åŠ¨æ—¥çƒ­é‡æ‘„å…¥ (å¡)</text>
        <input 
          class="form-input" 
          type="number"
          placeholder="ä¾‹å¦‚ï¼š1500"
          value="{{goals.restDayCalories}}"
          data-field="restDayCalories"
          bindinput="onInputChange"
        />
        <text class="form-hint" wx:if="{{calorieRecommendation}}">
          å»ºè®®: {{calorieRecommendation.restDayIntake}} å¡
        </text>
        <text class="form-hint" wx:else>
          å»ºè®®: {{tdee}} å¡ï¼ˆç»´æŒä½“é‡ï¼‰
        </text>
      </view>
      
      <view class="form-item">
        <view class="calorie-difference" wx:if="{{calorieRecommendation && goals.exerciseDayCalories && parseInt(goals.exerciseDayCalories) > 0}}">
          <text class="difference-label" wx:if="{{calorieRecommendation.goalType === 'lose'}}">
            çƒ­é‡ç¼ºå£: 
          </text>
          <text class="difference-label" wx:if="{{calorieRecommendation.goalType === 'gain'}}">
            çƒ­é‡ç›ˆä½™: 
          </text>
          <text class="difference-value" wx:if="{{calorieRecommendation.goalType === 'lose'}}">
            {{calorieRecommendation.exerciseDayIntake - parseInt(goals.exerciseDayCalories)}} å¡
          </text>
          <text class="difference-value" wx:if="{{calorieRecommendation.goalType === 'gain'}}">
            {{parseInt(goals.exerciseDayCalories) - calorieRecommendation.exerciseDayIntake}} å¡
          </text>
        </view>
        <text class="form-label">è¿åŠ¨æ—¥çƒ­é‡æ‘„å…¥ (å¡)</text>
        <input 
          class="form-input" 
          type="number"
          placeholder="ä¾‹å¦‚ï¼š2000"
          value="{{goals.exerciseDayCalories}}"
          data-field="exerciseDayCalories"
          bindinput="onInputChange"
        />
        <text class="form-hint" wx:if="{{calorieRecommendation}}">
          å»ºè®®: {{calorieRecommendation.exerciseDayIntake}} å¡ï¼ˆè¿åŠ¨æ¶ˆè€— {{calorieRecommendation.exerciseCalories}} å¡ï¼‰
        </text>
        <text class="form-hint" wx:else>
          å»ºè®®: {{tdee}} å¡ï¼ˆç»´æŒä½“é‡ï¼‰
        </text>
      </view>
      
      <view class="form-item">
        <text class="form-label">æ¯æ—¥è¿åŠ¨æ—¶é•¿ (åˆ†é’Ÿ)</text>
        <input 
          class="form-input" 
          type="number"
          placeholder="ä¾‹å¦‚ï¼š30"
          value="{{goals.dailyExercise}}"
          data-field="dailyExercise"
          bindinput="onInputChange"
        />
        <text class="form-hint">å»ºè®®: è‡³å°‘30åˆ†é’Ÿ</text>
      </view>
    </view>
  </view>

  <!-- ä¿å­˜æŒ‰é’® -->
  <view class="save-section">
    <button class="save-btn" bindtap="saveGoals">ä¿å­˜ç›®æ ‡</button>
  </view>

  <!-- æ¸©é¦¨æç¤º -->
  <view class="tips-card">
    <text class="tips-title">ğŸ“ æ¸©é¦¨æç¤º</text>
    <text class="tips-text">â€¢ ç›®æ ‡åº”è¯¥åˆç†å¯è¡Œï¼Œä¸è¦è¿‡äºæ¿€è¿›</text>
    <text class="tips-text">â€¢ å¥åº·å‡é‡é€Ÿåº¦ä¸ºæ¯å‘¨0.5-1kg</text>
    <text class="tips-text">â€¢ é…åˆè¿åŠ¨å’Œé¥®é£Ÿæ§åˆ¶æ•ˆæœæ›´ä½³</text>
    <text class="tips-text">â€¢ æŒä¹‹ä»¥æ’æ˜¯æˆåŠŸçš„å…³é”®</text>
  </view>
</view>

