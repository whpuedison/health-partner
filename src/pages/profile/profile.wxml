<!--pages/profile/profile.wxml-->
<view class="profile-page">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view class="user-header">
      <block wx:if="{{hasUserInfo}}">
        <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        <view class="user-info">
          <text class="nickname">{{userInfo.nickName}}</text>
          <view class="user-data">
            <text class="data-item">èº«é«˜ {{profile.height}}cm</text>
            <text class="data-divider">|</text>
            <text class="data-item">ä½“é‡ {{profile.weight}}kg</text>
            <text class="data-divider">|</text>
            <text class="data-item">BMI {{profile.bmi}}</text>
          </view>
        </view>
      </block>
      <block wx:else>
        <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
          <image wx:if="{{userInfo && userInfo.avatarUrl}}" class="avatar-placeholder" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
          <view wx:else class="avatar-placeholder">ğŸ‘¤</view>
        </button>
        <view class="user-info">
          <input 
            class="nickname-input" 
            type="nickname" 
            placeholder="ç‚¹å‡»è®¾ç½®æ˜µç§°"
            bindinput="onNicknameInput"
            bindblur="onNicknameInput"
            value="{{nickname || (userInfo && userInfo.nickName) || ''}}"
          />
        </view>
      </block>
    </view>
  </view>

  <!-- ç»Ÿè®¡æ•°æ® -->
  <view class="stats-section">
    <view class="stats-card">
      <view class="stat-item">
        <text class="stat-value">{{stats.totalDays}}</text>
        <text class="stat-label">åšæŒå¤©æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.dietRecords}}</text>
        <text class="stat-label">é¥®é£Ÿè®°å½•</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.exerciseRecords}}</text>
        <text class="stat-label">è¿åŠ¨è®°å½•</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">{{stats.healthRecords}}</text>
        <text class="stat-label">å¥åº·è®°å½•</text>
      </view>
    </view>
  </view>

  <!-- æˆ‘çš„ç›®æ ‡ -->
  <view class="goals-section">
    <view class="section-header">
      <text class="section-title">æˆ‘çš„ç›®æ ‡</text>
      <text class="section-subtitle">è®¾å®šç›®æ ‡ï¼ŒæŒç»­è¿›æ­¥</text>
    </view>
    
    <view class="goals-grid">
      <view 
        class="goal-card" 
        wx:for="{{goals}}" 
        wx:key="id"
        style="background: {{item.color}}15; border-color: {{item.color}};"
        data-goal="{{item}}"
        bindtap="openGoalDialog"
      >
        <text class="goal-icon">{{item.icon}}</text>
        <text class="goal-title">{{item.title}}</text>
        <view class="goal-value-box">
          <text class="goal-value">{{item.value}}</text>
          <text class="goal-unit">{{item.unit}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <view class="menu-list">
      <view 
        class="menu-item" 
        wx:for="{{menuItems}}" 
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="onMenuTap"
      >
        <view class="menu-left">
          <text class="menu-icon">{{item.icon}}</text>
          <text class="menu-title">{{item.title}}</text>
        </view>
        <text class="menu-arrow" wx:if="{{item.arrow}}">â€º</text>
      </view>
    </view>
  </view>

  <!-- æ¸…é™¤æ•°æ®æŒ‰é’® -->
  <view class="clear-section">
    <button class="clear-btn" bindtap="clearData">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
  </view>

  <!-- ç›®æ ‡è®¾ç½®å¯¹è¯æ¡† -->
  <view class="dialog-mask" wx:if="{{showGoalDialog}}" bindtap="closeGoalDialog">
    <view class="dialog-content" catchtap="">
      <view class="dialog-header">
        <text class="dialog-title">{{editingGoal.icon}} {{editingGoal.title}}</text>
        <text class="dialog-close" bindtap="closeGoalDialog">âœ•</text>
      </view>
      
      <view class="dialog-body">
        <view class="form-item">
          <text class="form-label">ç›®æ ‡å€¼ ({{editingGoal.unit}})</text>
          <input 
            class="form-input" 
            type="digit"
            placeholder="è¯·è¾“å…¥ç›®æ ‡å€¼"
            value="{{goalValue}}"
            bindinput="onGoalInput"
          />
        </view>
      </view>
      
      <view class="dialog-footer">
        <button class="dialog-btn cancel" bindtap="closeGoalDialog">å–æ¶ˆ</button>
        <button class="dialog-btn confirm" bindtap="saveGoal">ä¿å­˜</button>
      </view>
    </view>
  </view>
</view>
