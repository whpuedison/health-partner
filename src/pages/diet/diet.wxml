<!--pages/diet/diet.wxml-->
<view class="diet-page">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">é¥®é£Ÿè®¡åˆ’</text>
    <text class="page-subtitle">è®°å½•æ¯ä¸€é¤ï¼ŒæŒæ¡è¥å…»æ‘„å…¥</text>
  </view>

  <!-- å¡è·¯é‡Œæ€»è§ˆ -->
  <view class="calorie-card">
    <view class="calorie-main">
      <text class="calorie-value">{{totalCalories}}</text>
      <text class="calorie-unit">/ {{targetCalories}} å¡</text>
    </view>
    <view class="calorie-progress">
      <view class="calorie-fill" style="width: {{totalCalories / targetCalories * 100}}%"></view>
    </view>
    <view class="calorie-status">
      <text>{{totalCalories >= targetCalories ? 'å·²è¾¾æ ‡ âœ“' : 'å‰©ä½™ ' + (targetCalories - totalCalories) + ' å¡'}}</text>
    </view>
  </view>

  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs">
    <view 
      class="tab-item {{activeTab === index ? 'active' : ''}}" 
      wx:for="{{tabs}}" 
      wx:key="index"
      data-index="{{index}}"
      bindtap="onTabChange"
    >
      {{item}}
    </view>
  </view>

  <!-- ä»Šæ—¥è®°å½• -->
  <view class="tab-content" wx:if="{{activeTab === 0}}">
    <!-- å¿«æ·æ·»åŠ  -->
    <view class="quick-meals">
      <view 
        class="meal-btn" 
        wx:for="{{quickMeals}}" 
        wx:key="name"
        style="background: {{item.color}}20; border-color: {{item.color}};"
        data-type="{{item.name}}"
        bindtap="openAddDialog"
      >
        <text class="meal-icon">{{item.icon}}</text>
        <text class="meal-name">{{item.name}}</text>
        <text class="meal-time">{{item.time}}</text>
      </view>
    </view>

    <!-- è®°å½•åˆ—è¡¨ -->
    <view class="records-list" wx:if="{{todayRecords.length > 0}}">
      <view class="record-item" wx:for="{{todayRecords}}" wx:key="id">
        <view class="record-main">
          <view class="record-info">
            <text class="record-meal">{{item.mealType}}</text>
            <text class="record-food">{{item.food}}</text>
            <text class="record-time">{{item.time}}</text>
          </view>
          <view class="record-calories">
            <text class="calories-value">{{item.calories}}</text>
            <text class="calories-unit">å¡</text>
          </view>
        </view>
        <view class="record-actions">
          <text class="delete-btn" data-id="{{item.id}}" bindtap="deleteRecord">åˆ é™¤</text>
        </view>
      </view>
    </view>

    <view class="empty-state" wx:else>
      <text class="empty-icon">ğŸ½ï¸</text>
      <text class="empty-text">è¿˜æ²¡æœ‰è®°å½•ï¼Œç‚¹å‡»ä¸Šæ–¹æ·»åŠ ä»Šæ—¥é¥®é£Ÿ</text>
    </view>
  </view>

  <!-- æ¨èé£Ÿè°± -->
  <view class="tab-content" wx:if="{{activeTab === 1}}">
    <view class="recipe-grid">
      <view class="recipe-card" wx:for="{{recommendations}}" wx:key="id">
        <image class="recipe-image" src="{{item.image}}" mode="aspectFill"></image>
        <view class="recipe-info">
          <text class="recipe-name">{{item.name}}</text>
          <view class="recipe-tags">
            <text class="recipe-tag">{{item.category}}</text>
            <text class="recipe-tag">{{item.calories}}å¡</text>
          </view>
          <text class="recipe-desc">{{item.description}}</text>
        </view>
        <view class="recipe-actions">
          <button class="recipe-btn detail" data-recipe="{{item}}" bindtap="viewRecipeDetail">æŸ¥çœ‹è¯¦æƒ…</button>
          <button class="recipe-btn primary" data-recipe="{{item}}" bindtap="useRecipe">ä½¿ç”¨</button>
        </view>
      </view>
    </view>
  </view>

  <!-- è¥å…»åˆ†æ -->
  <view class="tab-content" wx:if="{{activeTab === 2}}">
    <view class="nutrition-card">
      <text class="nutrition-title">ä»Šæ—¥è¥å…»æ‘„å…¥</text>
      
      <view class="nutrition-item">
        <view class="nutrition-header">
          <text class="nutrition-name">ğŸ¥© è›‹ç™½è´¨</text>
          <text class="nutrition-value">{{nutrition.protein}}g</text>
        </view>
        <view class="nutrition-bar">
          <view class="nutrition-fill protein" style="width: {{nutrition.protein / 100 * 100}}%"></view>
        </view>
      </view>

      <view class="nutrition-item">
        <view class="nutrition-header">
          <text class="nutrition-name">ğŸš ç¢³æ°´åŒ–åˆç‰©</text>
          <text class="nutrition-value">{{nutrition.carbs}}g</text>
        </view>
        <view class="nutrition-bar">
          <view class="nutrition-fill carbs" style="width: {{nutrition.carbs / 250 * 100}}%"></view>
        </view>
      </view>

      <view class="nutrition-item">
        <view class="nutrition-header">
          <text class="nutrition-name">ğŸ¥‘ è„‚è‚ª</text>
          <text class="nutrition-value">{{nutrition.fat}}g</text>
        </view>
        <view class="nutrition-bar">
          <view class="nutrition-fill fat" style="width: {{nutrition.fat / 70 * 100}}%"></view>
        </view>
      </view>

      <view class="nutrition-item">
        <view class="nutrition-header">
          <text class="nutrition-name">ğŸŒ¾ è†³é£Ÿçº¤ç»´</text>
          <text class="nutrition-value">{{nutrition.fiber}}g</text>
        </view>
        <view class="nutrition-bar">
          <view class="nutrition-fill fiber" style="width: {{nutrition.fiber / 30 * 100}}%"></view>
        </view>
      </view>
    </view>

    <view class="nutrition-tips">
      <text class="tips-title">ğŸ’¡ è¥å…»å»ºè®®</text>
      <text class="tips-text">â€¢ å»ºè®®æ¯æ—¥è›‹ç™½è´¨æ‘„å…¥çº¦ 100g</text>
      <text class="tips-text">â€¢ ç¢³æ°´åŒ–åˆç‰©æ§åˆ¶åœ¨ 250g å·¦å³</text>
      <text class="tips-text">â€¢ è„‚è‚ªæ‘„å…¥ä¸è¶…è¿‡ 70g</text>
      <text class="tips-text">â€¢ è†³é£Ÿçº¤ç»´è‡³å°‘ 25-30g</text>
    </view>
  </view>

  <!-- æ·»åŠ å¯¹è¯æ¡† -->
  <view class="dialog-mask" wx:if="{{showAddDialog}}" bindtap="closeAddDialog">
    <view class="dialog-content" catchtap="">
      <view class="dialog-header">
        <text class="dialog-title">æ·»åŠ {{currentMealType}}</text>
        <text class="dialog-close" bindtap="closeAddDialog">âœ•</text>
      </view>
      
      <view class="dialog-body">
        <view class="form-item">
          <text class="form-label">é£Ÿç‰©åç§°</text>
          <input 
            class="form-input" 
            placeholder="ä¾‹å¦‚ï¼šé¸¡èƒ¸è‚‰æ²™æ‹‰"
            value="{{foodInput}}"
            bindinput="onFoodInput"
          />
        </view>
        
        <view class="form-item">
          <text class="form-label">çƒ­é‡ï¼ˆå¡è·¯é‡Œï¼‰</text>
          <input 
            class="form-input" 
            type="number"
            placeholder="ä¾‹å¦‚ï¼š350"
            value="{{caloriesInput}}"
            bindinput="onCaloriesInput"
          />
        </view>
      </view>
      
      <view class="dialog-footer">
        <button class="dialog-btn cancel" bindtap="closeAddDialog">å–æ¶ˆ</button>
        <button class="dialog-btn confirm" bindtap="addRecord">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view>

